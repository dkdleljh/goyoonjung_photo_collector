# 고윤정 사진 수집 프로그램 사용설명서

## 개요

이 프로그램은 무료 데이터 소스를 사용해 배우 고윤정 사진을 수집합니다.

핵심 원칙:

- 유료 서비스 사용 안 함
- Instagram은 계정 전체 수집 금지, 사용자가 입력한 Seed URL만 사용
- 720p 이상만 저장
- 이미지 원본 바이트 그대로 저장
- SHA-256 중복 제거
- 결과 요약 자동 기록

## 준비하기

### 1. 프로젝트 위치

프로젝트 폴더:

`/home/zenith/goyoonjung_photo_collector`

### 2. 가상환경/패키지 설치

```bash
cd /home/zenith/goyoonjung_photo_collector
python -m venv .venv
source .venv/bin/activate  # Windows는 .venv\\Scripts\\activate
pip install -r requirements.txt
```

### 3. 환경변수 설정(.env)

```bash
cp .env.example .env
```

`.env`에 다음을 입력:

- `NAVER_CLIENT_ID=...`
- `NAVER_CLIENT_SECRET=...`
- `PHOTO_ROOT=` (선택)

`PHOTO_ROOT`를 비워두면 OS별 Desktop 자동 탐지를 사용합니다.

## 저장 위치 규칙

프로그램은 바탕화면 기준 최상위 폴더를 **오직 1개**만 사용합니다.

- 기본: `Desktop/Goyoonjung_Photos`
- `PHOTO_ROOT` 사용 시: `PHOTO_ROOT/Goyoonjung_Photos`

그 내부에만 하위 폴더가 생성됩니다.

예시:

```text
Goyoonjung_Photos/
  2026-02-08/
    naver/
    wikimedia/
    instagram_seed/
  meta/
    items.jsonl
    failed.jsonl
    dedup.sqlite
  logs/
    summary_2026-02-08.txt
```

## 실행 방법

### 기본 실행

```bash
python -m app.cli run
```

### provider 지정 실행

```bash
python -m app.cli run --providers "naver,wikimedia,instagram_seed"
```

### 검색어 지정 실행

```bash
python -m app.cli run --keywords "고윤정,고윤정 화보,Go Yoon-jung"
```

검색어를 생략하면 권장 키워드가 자동으로 적용됩니다.

## Instagram Seed 파일 작성

파일 경로:

`seeds/instagram_urls.txt`

형식:

- 한 줄에 URL 1개
- `#`으로 시작하면 주석

예시:

```txt
# 게시물 URL
https://www.instagram.com/p/xxxxxxxxxxx/

# 직접 이미지 URL
https://instagram.fxxx-xx.fna.fbcdn.net/v/t51.2885-15/....jpg
```

동작:

- 직접 이미지 URL: 바로 수집 후보
- 게시물 URL: HTML의 `og:image`를 추출해 수집 후보
- 로그인 필요/차단/미추출: 스킵 및 실패 로그 기록

## 내부 동작 요약

1. provider에서 후보 URL 수집
2. URL 중복 제거
3. 비동기 4 workers로 다운로드
4. `image/*` 타입 확인
5. Pillow로 이미지 디코드, 해상도 검사
6. SHA-256 중복 검사(SQLite)
7. 통과 시 원본 바이트 저장 + 성공 로그
8. 실패 시 사유와 함께 실패 로그
9. 종료 시 요약 출력 + summary 파일 저장

## 실패 사유 코드

- `MISSING_NAVER_KEYS`
- `DOWNLOAD_FAIL`
- `NOT_IMAGE`
- `IMAGE_DECODE_FAIL`
- `RESOLUTION_TOO_SMALL`
- `DUPLICATE`
- `INSTAGRAM_LOGIN_OR_BLOCKED`
- `OG_IMAGE_NOT_FOUND`

## 자동 실행 등록 (매일 19:00)

### Windows 작업 스케줄러

- 트리거: 매일 19:00
- 동작:
  - 프로그램: `...\\goyoonjung_photo_collector\\.venv\\Scripts\\python.exe`
  - 인수: `-m app.cli run`
  - 시작 위치: 프로젝트 루트

### macOS / Linux cron

```cron
0 19 * * * /path/to/goyoonjung_photo_collector/.venv/bin/python -m app.cli run >> /path/to/goyoonjung_photo_collector/cron.log 2>&1
```

주의:

- cron은 시스템 로컬 타임존을 사용합니다.
- KST 기준 실행을 원하면 서버/PC 타임존이 Asia/Seoul인지 확인하세요.

## 간단 실행 예시

```bash
cd /home/zenith/goyoonjung_photo_collector
source .venv/bin/activate
python -m app.cli run --providers "naver,wikimedia" --keywords "고윤정,Go Yoon-jung"
```

